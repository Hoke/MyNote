# 视频直播预研

## 概念

```text
CDN
  content delivery/distribute network, 内容分发网络。通过在网络各处放置节点服务器所构成的在现有互联网基础上的一层智能虚拟网络，CDN 系统能够实时根据网络流量和各节点的连接、负载状况以及到用户的距离和响应时间等综合信息将用户的请求重新导向离用户最近的服务节点。
  解决因分布、带宽、服务器性能带来的访问延迟问题，适用于站点加速、点播、直播等场景。使用户可就近取得所需内容，解决 Internet网络拥挤的状况，提高用户访问网站的响应速度和成功率。
```

## RTMP

视音频合流基于 RTMP 协议。目前主流的直播方案一般采用 RTMP 方式：客户端采集音视频流，并通过 RTMP 协议推流到流媒体服务器；流媒体服务器做一些编码处理等工作，然后将流分发给各个客户端，客户端进行拉流播放。

优点：

- CDN 支持良好，主流的 CDN 厂商都支持。
- 技术比较成熟，集成方便。集成对应平台的 SDK 即可进行推流。
- 相对于 P2P 的方式，并发度高，适用于多人直播场景。

缺点：

- 协议基于 TCP，相比 WebRTC 延时较大，对于某些低延时场景体验较差。
- 不支持浏览器推流。

## WebRTC

WebRTC 是 P2P 方式，主要适用于人数较少的视频会议等场景，各个节点分别建立 P2P 连接进行音视频传输。

优点：

- 在 Web 端，开发者不必熟悉流媒体，只需要调用 JS API；使用者只要打开浏览器进行播放。
- P2P 通信节省服务器带宽费用。
- WebRTC 基于 UDP 协议，比基于 TCP 的延时较低。

缺点：

- 客户端浏览器性能有限。如果多人直播连麦，浏览器需要同时给多人进行视频传输，性能差。
- 音视频处理困难。WebRTC 的 API 较少，继承第三方音视频处理方案较难。
- 音视频传输质量难以保障，尤其是跨地区、跨运营商时。
- 兼容性差。PC 端的主流浏览器(Chrome/Firefox/Safari/Opera/Edge)都支持 WebRTC，但是移动端只有部分浏览器支持。
- 不能控制媒体内容。比如无法在传输过程中审核。

## licode

licode 作为即时通话服务器，用于建立多人实时聊天。

## janus

janus 可以与内网设备和浏览器同时建立连接，并将浏览器发来的音视频数据包(如 rtp/rtcp 包)，通过自定义插件转发给内网设备，也可以将发给 janus 的音视频数据包，加密后转发给浏览器。

## 架构

引入流媒体服务器，客户端将视频传输到媒体服务器，其余客户端通过与媒体服务器建立连接进行音视频显示。

### licode 加 RTMP 协议

### janus 转换 RTMP 和 WebRTC

前端使用 WebRTC 采集和传输音视频到网关服务，网关服务将 WebRTC 协议转为 RTMP，合流之后转化为 WebRTC 分发给其他客户端。

## 参考
