# 第一章  温故而知新

- 计算机硬件三个关键部件：中央处理器 CPU，内存和 I/O 控制芯片
- 硬件历史变化
  - 早期的计算机硬件：每个设备的 I/O 控制器和 CPU 以及内存连同一总线
  - CPU 核心频率提升，产生了与内存频率一致的系统总线
  - 为了些协调 CPU、内存和高速的图形设备，设计高速的北桥芯片，以便其高速地交换数据
  - 设计南桥芯片，专门处理低速设备（磁盘、USB、键盘、鼠标等），由南桥汇总连到北桥
    - 系统总线用 PCI 结构，低速设备用 ISA 总线
- CPU 频率到达 4GHz 的极限，通过增加 CPU 的数量来增加 CPU 的速度
  - 对称多处理器（SMP，Symmetrical Multi-Processing），每个 CPU 在系统中所处的地位和发挥的功能一样，是相互对称的
  - 应用场合是商用的服务器和需要处理大量计算的环境
  - 多核处理器（Multi-core Processor），多个处理器“被打包”，共享比较昂贵的缓存部件
- 系统软件：管理计算机本身的软件
  - 平台性的：操作系统内核/驱动程序/运行库和其他系统工具
  - 用于程序开发的：编译器/汇编器/链接器等开发工具和开发库
- 计算机软件体系结构：硬件——硬件规格——操作系统内核——系统调用接口——运行时库——操作系统 API——应用软件
  - 硬件规格（Hardware Specification），由硬件生产厂商负责提供
  - 系统调用接口（System Call API），往往以软件中断（Software Interrupt）的方式提供
  - 操作系统应用程序编程接口（API，Application Programming Interface）
- 多道程序（Multiprogramming）设计：
  - 充分利用 CPU 资源
  - 当某个程序暂时不适用 CPU 时，监控程序把正在等待 CPU 资源的程序启动
  - 缺点：调度时不能满足需要即时响应的需求
- 分时系统（Time-Sharing System）：每个程序运行一段时间以后都主动让出 CPU 给其他程序
  - 缺点：当某个程序进入死循环，整个系统无法响应交互式需求
- 多任务系统（Multi-tasking System）：操作系统管理所有硬件资源，所有应用程序以进程的方式运行在比操作系统权限更低的级别
  - 每个进程拥有独立的地址空间，进程之间的地址空间互相隔离
  - 操作系统统一分配 CPU，根据每个进程的优先级分配
  - 进程运行时间超出一定阈值，操作系统会暂停该进程，将 CPU 资源分配给其他等待运行的进程，即抢占式（Preemptive），操作系统可以强制剥夺 CPU 资源并且分配给它认为目前最需要的进程
  - 硬件驱动（Device Driver）程序：和操作系统内核一起运行在特权级，但与操作系统内核直接有一定的独立性。将硬件抽象成一系列概念，提供统一的硬件访问模式。
    - 驱动程序的开发工作通常由硬件生产厂商完成。
    - 操作系统开发者提供一系列接口和框架，硬件生产厂商安装该接口和框架开发的驱动程序都可以在操作系统上使用。
- 内存：
  - 早期计算机的程序运行在物理内存，即使用物理地址空间（Physical Address Space）
    - 问题：地址空间不隔离；内存使用效率低；程序运行的地址不确定
  - 虚拟地址空间（Virtual Address Space）：每个进程都挺自己独立的虚拟空间，且只能访问自己的虚拟地址空间
    - 分段（Segmentation）：分段对内存区域的映射仍以程序为单位，内存不足时内存的切换以程序为单位，会影响速度
    - 分页（Paging）：把地址空间等分成固定大小的页，每页大小由硬件决定，或硬件支持多种大小的页，由操作系统选择决定页的大小。
      - 虚拟页（VP，Virtual Page）
      - 物理页（PP，Physical Page）
      - 磁盘页（DP，Disk Page）
