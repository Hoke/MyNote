# 计算 RTP 时间戳

- [计算 RTP 时间戳](#计算-rtp-时间戳)
  - [RTP 时间戳](#rtp-时间戳)
  - [音频 RTP 时间戳](#音频-rtp-时间戳)
  - [视频 RTP 时间戳](#视频-rtp-时间戳)
  - [参考](#参考)

## RTP 时间戳

RTP 时间戳是 RTP 头域一个重要的属性，用于在回放时以正确的顺序插入包。它也用于同步音频和视频包，

RTP 时间戳的计算涉及两个参数：

- 封包时间：封包时间表示一个 RTP 包的时长，单位是毫秒。比如，一个 G711 的包可能表示 20ms。注意除了 20ms 其他封包时间也是有效的。
- 采样率：采样率是每秒模拟的采样转为数字形式的数量。在 G711 中，采样率是 8kHz。因此每秒获取 8000 个模拟的采样转为数字形式。采样率越高，质量越好。

## 音频 RTP 时间戳

音频时间戳可以选择一个随机值。对于后续的音频 RTP 包，时间戳应该增加 `采样率/每秒的包数`。假定采样率是 8kHz，封包时间是 20ms：

- 一帧对应 20ms
- 一秒的帧数为 1s/20ms = 50
- 音频 RTP 包的时间戳的差值为 8kHz/50=160，表示每帧有 160 个采样

## 视频 RTP 时间戳

对于视频，一般是每秒 30 帧或 24 帧。

假定采样率是 90kHz，帧率是 30fps：视频 RTP 包的时间戳差值为 90kHz/30=3000，表示每帧有 3000 个采样。因此每个视频 RTP 帧的时间戳应增加 3000。

实际上，每个视频帧因为太大可能通过不止一个 RTP 包发送。假定一个视频帧通过 3 个 RTP 包。对于这 3 个 RTP 包，需要保证时间戳一样。对于下一个视频帧，RTP 时间戳增加 3000。

在一些情况下，如果不知道帧率，可能需要获取系统时间生成时间戳。

## 参考

- [RTP Timestamp Calculation](https://lmtools.com/content/rtp-timestamp-calculation)
